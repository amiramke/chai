require 'oauth'
require 'json'

module YelpHelper
  #Ferdi:
  # CONSUMER_KEY = 's3OFJZeLxXg4Zpyik4-Qng'
  # CONSUMER_SECRET = 'CEoKVSBOfl7I_GBsH_5McAqyv0U'
  # TOKEN = 'I0EhDz5uRcD44f5QrL38Bl6vdwSpitlR'
  # TOKEN_SECRET = 'UPrz5Tf3_L_DswN3zu2nCeJ2c4c'
  #Ami:

  CONSUMER_KEY = 'oQp4rtg9Br5pqsu56T_f-Q'
  CONSUMER_SECRET = 'QdxcWLugM2MP7vXsyzZsAO1e9z8'
  TOKEN = 'mtAJKfk5KNHQ1HHfvhFq4pRfp70iWy6v'
  TOKEN_SECRET = 'TlAyQHs-JmhXGNyUlbXRDKz77Lk'

  def self.api_host
    'api.yelp.com'
  end

  def self.api_search_path
    '/v2/search'
  end

  def self.consumer
    @consumer ||= OAuth::Consumer.new(CONSUMER_KEY, CONSUMER_SECRET, {:site => "http://#{api_host}"})
  end

  def self.access_token
    @access_token ||= OAuth::AccessToken.new(consumer, TOKEN, TOKEN_SECRET)
  end

  def self.search(location)
    location ||= "37.788022,-122.399797"
    # puts businesses.length
    # puts coffeeplaces.sort_by!{|i| i[1]}
    { businesses: get_businesses(location), region: get_region(location) }
    #get_businesses(location)
  end


  def self.get_businesses(location)
    businesses(location).collect do |coffee|
      [
        coffee['name'],
        coffee['distance'],
        coffee['rating'],
        coffee['review_count'],
        coffee['location']['coordinate']['latitude'],
        coffee['location']['coordinate']['longitude'],
      ]
    end
  end

  def self.get_region(location)
    info = region(location)#.collect do |coffee|
        # puts "***************"
        # puts info
        # puts "***************"
      [
        info['span']['latitude_delta'],
        info['span']['latitude_delta'],
        info['span']['longitude_delta'],
        info['center']['latitude'],
        info['center']['longitude'],
      ]
    #end
  end

  def self.query(location)
    access_token.get(path(location)).body
    # yelp_query = <<-eos
    # {"region": {"span": {"latitude_delta": 0.012887820000003103, "longitude_delta": 0.010180759531806416}, "center": {"latitude": 37.776570800000002, "longitude": -122.41956671796899}}, "total": 331, "businesses": [{"is_claimed": true, "distance": 221.91918693942677, "mobile_url": "http://m.yelp.com/biz/mavelous-san-francisco", "rating_img_url": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/99493c12711e/ico/stars/stars_4_half.png", "review_count": 114, "name": "Ma'velous", "snippet_image_url": "http://s3-media4.ak.yelpcdn.com/photo/ZAW8kMJYra2b59uMKmQgTg/ms.jpg", "rating": 4.5, "url": "http://www.yelp.com/biz/mavelous-san-francisco", "location": {"cross_streets": "Polk St \u0026 Fell St", "city": "San Francisco", "display_address": ["1408 Market St", "(b/t Polk St \u0026 Fell St)", "Civic Center", "San Francisco, CA 94102"], "geo_accuracy": 8, "neighborhoods": ["Civic Center", "SoMa"], "postal_code": "94102", "country_code": "US", "address": ["1408 Market St"], "coordinate": {"latitude": 37.776405799999999, "longitude": -122.41771660000001}, "state_code": "CA"}, "phone": "4156268884", "snippet_text": "Ma'velous=Marvellous? \n\nThis place is truly a hidden jewel in the Civic Center area. Not only does the place reminds me of an antique shop from the 50's but...", "image_url": "http://s3-media2.ak.yelpcdn.com/bphoto/XnnsAbzSmmEC0t_ucb7Hyg/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"], ["Wine Bars", "wine_bars"]], "display_phone": "+1-415-626-8884", "rating_img_url_large": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/9f83790ff7f6/ico/stars/stars_large_4_half.png", "id": "mavelous-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/a5221e66bc70/ico/stars/stars_small_4_half.png"}, {"is_claimed": false, "distance": 373.52752278369076, "mobile_url": "http://m.yelp.com/biz/blue-bottle-coffee-san-francisco-8", "rating_img_url": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/99493c12711e/ico/stars/stars_4_half.png", "review_count": 1367, "name": "Blue Bottle Coffee", "snippet_image_url": "http://s3-media3.ak.yelpcdn.com/photo/5m6ZVjsejh-VzYER1C24Hg/ms.jpg", "rating": 4.5, "url": "http://www.yelp.com/biz/blue-bottle-coffee-san-francisco-8", "location": {"cross_streets": "Octavia St \u0026 Gough St", "city": "San Francisco", "display_address": ["315 Linden St", "(b/t Octavia St \u0026 Gough St)", "Hayes Valley", "San Francisco, CA 94102"], "geo_accuracy": 8, "neighborhoods": ["Hayes Valley", "Western Addition"], "postal_code": "94102", "country_code": "US", "address": ["315 Linden St"], "coordinate": {"latitude": 37.776326500000003, "longitude": -122.42327969999999}, "state_code": "CA"}, "phone": "4152527535", "snippet_text": "Fully deserving of 5 stars.\n\nService: The people running this are friendly and amazing. They were extremely gracious to the lady in front of us who ordered...", "image_url": "http://s3-media3.ak.yelpcdn.com/bphoto/-fAdfT5VM41U2nsvsmHsaA/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "display_phone": "+1-415-252-7535", "rating_img_url_large": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/9f83790ff7f6/ico/stars/stars_large_4_half.png", "id": "blue-bottle-coffee-san-francisco-8", "is_closed": false, "rating_img_url_small": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/a5221e66bc70/ico/stars/stars_small_4_half.png"}, {"is_claimed": false, "distance": 0.070868093367757637, "mobile_url": "http://m.yelp.com/biz/bicycle-coffee-co-san-francisco", "rating_img_url": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/stars_4.png", "review_count": 22, "name": "Bicycle Coffee Co", "snippet_image_url": "http://s3-media1.ak.yelpcdn.com/photo/VyXFFGBxQ7DcOLq_KJEriA/ms.jpg", "rating": 4.0, "url": "http://www.yelp.com/biz/bicycle-coffee-co-san-francisco", "snippet_text": "Bicycle Coffee is reminiscent of Courier Coffee Roasters in Portland. Same idea of delivery by bike. Same philosophy. Same vibe. Fair trade, organically...", "image_url": "http://s3-media2.ak.yelpcdn.com/bphoto/A56o2PdFiL2N_U-FGmkr6w/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "rating_img_url_small": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/f62a5be2f902/ico/stars/stars_small_4.png", "rating_img_url_large": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/ccf2b76faa2c/ico/stars/stars_large_4.png", "id": "bicycle-coffee-co-san-francisco", "is_closed": false, "location": {"city": "San Francisco", "display_address": ["SoMa", "San Francisco, CA"], "geo_accuracy": 4, "neighborhoods": ["SoMa"], "country_code": "US", "address": [], "coordinate": {"latitude": 37.774929499999999, "longitude": -122.4194155}, "state_code": "CA"}}, {"is_claimed": false, "distance": 0.070868093367757637, "mobile_url": "http://m.yelp.com/biz/mixte-inc-san-francisco", "rating_img_url": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/f1def11e4e79/ico/stars/stars_5.png", "review_count": 5, "name": "Mixte Inc", "snippet_image_url": "http://s3-media2.ak.yelpcdn.com/photo/bsY7xBEKXj7yVKSbSQRC0Q/ms.jpg", "rating": 5.0, "url": "http://www.yelp.com/biz/mixte-inc-san-francisco", "snippet_text": "I love Mixte!  They know their coffee AND flavor pairings.  My favorite is the lemon.  Pretty much any time I see those bottles, I can't resist drinking one!", "image_url": "http://s3-media2.ak.yelpcdn.com/bphoto/UdHdvlF2N67TsUIHA3AQmw/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "rating_img_url_small": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/c7623205d5cd/ico/stars/stars_small_5.png", "rating_img_url_large": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/22affc4e6c38/ico/stars/stars_large_5.png", "id": "mixte-inc-san-francisco", "is_closed": false, "location": {"city": "San Francisco", "display_address": ["SoMa", "San Francisco, CA"], "geo_accuracy": 4, "neighborhoods": ["SoMa"], "country_code": "US", "address": [], "coordinate": {"latitude": 37.774929499999999, "longitude": -122.4194155}, "state_code": "CA"}}, {"is_claimed": false, "distance": 313.95964649135448, "mobile_url": "http://m.yelp.com/biz/cumaica-coffee-san-francisco", "rating_img_url": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/5ef3eb3cb162/ico/stars/stars_3_half.png", "review_count": 39, "name": "Cumaica Coffee", "snippet_image_url": "http://s3-media2.ak.yelpcdn.com/photo/TdI0NnLRter-6CjnYqxe1A/ms.jpg", "rating": 3.5, "url": "http://www.yelp.com/biz/cumaica-coffee-san-francisco", "location": {"cross_streets": "Grace St \u0026 10th St", "city": "San Francisco", "display_address": ["1398 Mission St", "(b/t Grace St \u0026 10th St)", "SoMa", "San Francisco, CA 94103"], "geo_accuracy": 8, "neighborhoods": ["SoMa"], "postal_code": "94103", "country_code": "US", "address": ["1398 Mission St"], "coordinate": {"latitude": 37.775495200000002, "longitude": -122.4159154}, "state_code": "CA"}, "phone": "4155512600", "snippet_text": "I'm sick of crap like Starbucks, seriously. I'm tired of all the \"hipsters\" and Wall Street-esque tools and inept people who like crappy, burnt coffee and...", "image_url": "http://s3-media1.ak.yelpcdn.com/bphoto/kAC2BRpo9b4rYFhFt1Dl6g/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"], ["Internet Cafes", "internetcafe"]], "display_phone": "+1-415-551-2600", "rating_img_url_large": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/bd9b7a815d1b/ico/stars/stars_large_3_half.png", "id": "cumaica-coffee-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/2e909d5d3536/ico/stars/stars_small_3_half.png"}, {"is_claimed": false, "distance": 101.91287574811996, "mobile_url": "http://m.yelp.com/biz/adams-organic-coffees-san-francisco", "rating_img_url": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/99493c12711e/ico/stars/stars_4_half.png", "review_count": 3, "name": "Adam's Organic Coffees", "snippet_image_url": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/07ecbaa39caf/gfx/blank_user_medium.gif", "rating": 4.5, "url": "http://www.yelp.com/biz/adams-organic-coffees-san-francisco", "location": {"city": "San Francisco", "display_address": ["SoMa", "San Francisco, CA 94101"], "geo_accuracy": 5, "neighborhoods": ["SoMa"], "postal_code": "94101", "country_code": "US", "address": [], "coordinate": {"latitude": 37.775010000000002, "longitude": -122.41826}, "state_code": "CA"}, "phone": "8003392326", "snippet_text": "I started buying this coffee at the Height Street Market and have never looked back. I recommend a ceramic drip and Straus milk, this will get you the...", "image_url": "http://s3-media3.ak.yelpcdn.com/bphoto/Sn-KTv1fthsCtWFj-c8wew/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "display_phone": "+1-800-339-2326", "rating_img_url_large": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/9f83790ff7f6/ico/stars/stars_large_4_half.png", "id": "adams-organic-coffees-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/a5221e66bc70/ico/stars/stars_small_4_half.png"}, {"is_claimed": true, "distance": 429.63351253271196, "mobile_url": "http://m.yelp.com/biz/mercury-cafe-san-francisco", "rating_img_url": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/stars_4.png", "review_count": 143, "name": "Mercury Cafe", "snippet_image_url": "http://s3-media2.ak.yelpcdn.com/photo/6xfkzyKWTwLhmwN3pDNumQ/ms.jpg", "rating": 4.0, "url": "http://www.yelp.com/biz/mercury-cafe-san-francisco", "location": {"cross_streets": "Lily St \u0026 Page St", "city": "San Francisco", "display_address": ["201 Octavia St", "(b/t Lily St \u0026 Page St)", "Hayes Valley", "San Francisco, CA 94102"], "geo_accuracy": 8, "neighborhoods": ["Hayes Valley"], "postal_code": "94102", "country_code": "US", "address": ["201 Octavia St"], "coordinate": {"latitude": 37.773879399999998, "longitude": -122.4241194}, "state_code": "CA"}, "phone": "4152527855", "snippet_text": "From Chicago, went to SF for a week, ended up eating breakfast here three times in that week. Its great!\n\nSeems like a locals place, unassuming, but really...", "image_url": "http://s3-media3.ak.yelpcdn.com/bphoto/9F6C5r9TjUBdhWvZ9g6tew/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"], ["Sandwiches", "sandwiches"]], "display_phone": "+1-415-252-7855", "rating_img_url_large": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/ccf2b76faa2c/ico/stars/stars_large_4.png", "id": "mercury-cafe-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/f62a5be2f902/ico/stars/stars_small_4.png"}, {"is_claimed": true, "distance": 117.20437779829223, "mobile_url": "http://m.yelp.com/biz/cafico-san-francisco", "rating_img_url": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/34bc8086841c/ico/stars/stars_3.png", "review_count": 28, "name": "Cafico", "snippet_image_url": "http://s3-media4.ak.yelpcdn.com/photo/HblFfE54C32sc-i8cru4Nw/ms.jpg", "rating": 3.0, "url": "http://www.yelp.com/biz/cafico-san-francisco", "location": {"cross_streets": "10th St \u0026 Fell St", "city": "San Francisco", "display_address": ["1475 Market St", "(b/t 10th St \u0026 Fell St)", "SoMa", "San Francisco, CA 94103"], "geo_accuracy": 8, "neighborhoods": ["SoMa"], "postal_code": "94103", "country_code": "US", "address": ["1475 Market St"], "coordinate": {"latitude": 37.7756167, "longitude": -122.4184044}, "state_code": "CA"}, "phone": "4155524449", "snippet_text": "I agree with Ally L. An average cafe at best. The coffee is pretty weak. They have Numbi tea bags, fresh squeezed orange juice, and the regular expresso...", "image_url": "http://s3-media4.ak.yelpcdn.com/bphoto/Oo2_hkNENfd_jdmwjciEEQ/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"], ["Bakeries", "bakeries"]], "display_phone": "+1-415-552-4449", "rating_img_url_large": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/e8b5b79d37ed/ico/stars/stars_large_3.png", "id": "cafico-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/902abeed0983/ico/stars/stars_small_3.png"}, {"is_claimed": false, "distance": 312.58100229375179, "mobile_url": "http://m.yelp.com/biz/starbucks-san-francisco-166", "rating_img_url": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/34bc8086841c/ico/stars/stars_3.png", "review_count": 57, "name": "Starbucks", "snippet_image_url": "http://s3-media2.ak.yelpcdn.com/photo/eXW5NLmwHRzq7ZdRVgUmDw/ms.jpg", "rating": 3.0, "url": "http://www.yelp.com/biz/starbucks-san-francisco-166", "location": {"cross_streets": "Larkin St \u0026 9th St", "city": "San Francisco", "display_address": ["1390 Market St", "Ste 107", "(b/t Larkin St \u0026 9th St)", "Civic Center", "San Francisco, CA 94102"], "geo_accuracy": 9, "neighborhoods": ["Civic Center"], "postal_code": "94102", "country_code": "US", "address": ["1390 Market St", "Ste 107"], "coordinate": {"latitude": 37.777223900000003, "longitude": -122.417361}, "state_code": "CA"}, "phone": "4158638332", "snippet_text": "I appreciate the Asian guy who made my drink this morning. I'm 7 months pregnant and needed to know exactly how many caffeine milligrams were in the skinny...", "image_url": "http://s3-media1.ak.yelpcdn.com/bphoto/9q7iRB8MveE7cYomJp2UHQ/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "display_phone": "+1-415-863-8332", "rating_img_url_large": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/e8b5b79d37ed/ico/stars/stars_large_3.png", "id": "starbucks-san-francisco-166", "is_closed": false, "rating_img_url_small": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/902abeed0983/ico/stars/stars_small_3.png"}, {"is_claimed": false, "distance": 430.7735034961562, "mobile_url": "http://m.yelp.com/biz/coffee-mine-san-francisco", "rating_img_url": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/stars_4.png", "review_count": 29, "name": "Coffee Mine", "snippet_image_url": "http://s3-media1.ak.yelpcdn.com/photo/3K7UIMosLELBFwxGeMwn3A/ms.jpg", "rating": 4.0, "url": "http://www.yelp.com/biz/coffee-mine-san-francisco", "location": {"city": "San Francisco", "display_address": ["79 9th Street", "SoMa", "San Francisco, CA 94103"], "geo_accuracy": 8, "neighborhoods": ["SoMa"], "postal_code": "94103", "country_code": "US", "address": ["79 9th Street"], "coordinate": {"latitude": 37.776631700000003, "longitude": -122.4150125}, "state_code": "CA"}, "phone": "4152529795", "snippet_text": "Egg salad sandwich on dutch crunch for $3.50!  The egg salad is made upon order.  This place is by no means fancy, but of the old school low budget sandwich...", "image_url": "http://s3-media4.ak.yelpcdn.com/bphoto/C56PDQ94Eu9SIweARkIK7g/ms.jpg", "categories": [["Restaurants", "restaurants"], ["Coffee \u0026 Tea", "coffee"]], "display_phone": "+1-415-252-9795", "rating_img_url_large": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/ccf2b76faa2c/ico/stars/stars_large_4.png", "id": "coffee-mine-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/f62a5be2f902/ico/stars/stars_small_4.png"}, {"is_claimed": false, "distance": 365.22899452684823, "mobile_url": "http://m.yelp.com/biz/arlequin-caf%C3%A9-san-francisco-3", "rating_img_url": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/stars_4.png", "review_count": 392, "name": "Arlequin Caf\u00e9", "snippet_image_url": "http://s3-media4.ak.yelpcdn.com/photo/l2WxLTCqLvxmQ5aiTKcJ8w/ms.jpg", "rating": 4.0, "url": "http://www.yelp.com/biz/arlequin-caf%C3%A9-san-francisco-3", "location": {"cross_streets": "Franklin St \u0026 Gough St", "city": "San Francisco", "display_address": ["384 Hayes St", "(b/t Franklin St \u0026 Gough St)", "Hayes Valley", "San Francisco, CA 94102"], "geo_accuracy": 8, "neighborhoods": ["Hayes Valley", "Western Addition"], "postal_code": "94102", "country_code": "US", "address": ["384 Hayes St"], "coordinate": {"latitude": 37.776934799999999, "longitude": -122.42270569999999}, "state_code": "CA"}, "phone": "4156261211", "snippet_text": "The food is pretty standard. I don't eat much meat and I don't love the other options; but my brothers, who eat anything, loved the food. \n\nI come here for...", "image_url": "http://s3-media2.ak.yelpcdn.com/bphoto/A3rgMCfkzjYqQTD22lnWxg/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"], ["Desserts", "desserts"], ["Sandwiches", "sandwiches"]], "display_phone": "+1-415-626-1211", "rating_img_url_large": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/ccf2b76faa2c/ico/stars/stars_large_4.png", "id": "arlequin-caf\u00e9-san-francisco-3", "is_closed": false, "rating_img_url_small": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/f62a5be2f902/ico/stars/stars_small_4.png"}, {"is_claimed": false, "distance": 0.070868093367757637, "mobile_url": "http://m.yelp.com/biz/cole-coffee-san-francisco", "rating_img_url": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/5ef3eb3cb162/ico/stars/stars_3_half.png", "review_count": 3, "name": "Cole Coffee", "snippet_image_url": "http://s3-media1.ak.yelpcdn.com/photo/CCRqU-aicsT3MUHzNZKVHQ/ms.jpg", "rating": 3.5, "url": "http://www.yelp.com/biz/cole-coffee-san-francisco", "snippet_text": "I really enjoy the coffee and the atmosphere at Cole's Coffee.  The location is perfect, not too far or too close to Haight. I don't have a problem with the...", "categories": [["Coffee \u0026 Tea", "coffee"]], "rating_img_url_small": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/2e909d5d3536/ico/stars/stars_small_3_half.png", "rating_img_url_large": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/bd9b7a815d1b/ico/stars/stars_large_3_half.png", "id": "cole-coffee-san-francisco", "is_closed": false, "location": {"city": "San Francisco", "display_address": ["SoMa", "San Francisco, CA"], "geo_accuracy": 4, "neighborhoods": ["SoMa"], "country_code": "US", "address": [], "coordinate": {"latitude": 37.774929499999999, "longitude": -122.4194155}, "state_code": "CA"}}, {"is_claimed": true, "distance": 477.07192840971328, "mobile_url": "http://m.yelp.com/biz/java-detour-san-francisco", "rating_img_url": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/99493c12711e/ico/stars/stars_4_half.png", "review_count": 111, "name": "Java Detour", "snippet_image_url": "http://s3-media1.ak.yelpcdn.com/photo/33SFHEPcONQSoKKdLEpdgw/ms.jpg", "rating": 4.5, "url": "http://www.yelp.com/biz/java-detour-san-francisco", "location": {"cross_streets": "Plum St \u0026 Howard St", "city": "San Francisco", "display_address": ["170 S Van Ness Ave", "(b/t Plum St \u0026 Howard St)", "SoMa", "San Francisco, CA 94103"], "geo_accuracy": 8, "neighborhoods": ["SoMa"], "postal_code": "94103", "country_code": "US", "address": ["170 S Van Ness Ave"], "coordinate": {"latitude": 37.770712699999997, "longitude": -122.41841049999999}, "state_code": "CA"}, "phone": "4156265352", "snippet_text": "I love Java Detour! \nWe noticed it looked kinda lonely as we were headed toward 101S and decided to stop by bc they have a drive through and a drink on the...", "image_url": "http://s3-media1.ak.yelpcdn.com/bphoto/t7KWfTH9HmUCULe8TlzTbA/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "display_phone": "+1-415-626-5352", "rating_img_url_large": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/9f83790ff7f6/ico/stars/stars_large_4_half.png", "id": "java-detour-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/a5221e66bc70/ico/stars/stars_small_4_half.png"}, {"is_claimed": false, "distance": 451.77112368232815, "mobile_url": "http://m.yelp.com/biz/ritual-coffee-roasters-san-francisco-5", "rating_img_url": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/stars_4.png", "review_count": 101, "name": "Ritual Coffee Roasters", "snippet_image_url": "http://s3-media2.ak.yelpcdn.com/photo/Z8gp3a9o6yV7Ee9xiO2VdA/ms.jpg", "rating": 4.0, "url": "http://www.yelp.com/biz/ritual-coffee-roasters-san-francisco-5", "snippet_text": "I'm a total fan of their drip coffees (~$3? I believe) and lattes ( $4.50 w/ soy) . STRONG and rich flavors- I'm always sad(yet jittery!) when I'm nearing...", "image_url": "http://s3-media1.ak.yelpcdn.com/bphoto/nMqJwboeAK6kG79w-KAgCw/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "rating_img_url_small": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/f62a5be2f902/ico/stars/stars_small_4.png", "rating_img_url_large": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/ccf2b76faa2c/ico/stars/stars_large_4.png", "id": "ritual-coffee-roasters-san-francisco-5", "is_closed": false, "location": {"cross_streets": "Fell St \u0026 Linden St", "city": "San Francisco", "display_address": ["432 Octavia", "Unit 1B", "(b/t Fell St \u0026 Linden St)", "Hayes Valley", "San Francisco, CA 94102"], "geo_accuracy": 9, "neighborhoods": ["Hayes Valley", "Western Addition"], "postal_code": "94102", "country_code": "US", "address": ["432 Octavia", "Unit 1B"], "coordinate": {"latitude": 37.776424407958999, "longitude": -122.424194335938}, "state_code": "CA"}}, {"is_claimed": false, "distance": 56.307060808747572, "mobile_url": "http://m.yelp.com/biz/all-star-cafe-san-francisco", "rating_img_url": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/34bc8086841c/ico/stars/stars_3.png", "review_count": 43, "name": "All Star Cafe", "snippet_image_url": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/07ecbaa39caf/gfx/blank_user_medium.gif", "rating": 3.0, "url": "http://www.yelp.com/biz/all-star-cafe-san-francisco", "location": {"cross_streets": "United States Highway 101 \u0026 Van Ness Ave", "city": "San Francisco", "display_address": ["1550 Market St", "(b/t United States Highway 101 \u0026 Van Ness Ave)", "Hayes Valley", "San Francisco, CA 94102"], "geo_accuracy": 8, "neighborhoods": ["Hayes Valley", "Civic Center"], "postal_code": "94102", "country_code": "US", "address": ["1550 Market St"], "coordinate": {"latitude": 37.774814999999997, "longitude": -122.42003920000001}, "state_code": "CA"}, "phone": "4152529888", "snippet_text": "This place is certainly not gourmet, but look at it and look at the prices. It should be gross.  It is not gross, however, and the avocado sandwich is in...", "image_url": "http://s3-media3.ak.yelpcdn.com/bphoto/M-f9lylCz7u-S3DJc8LMWw/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"], ["Donuts", "donuts"]], "display_phone": "+1-415-252-9888", "rating_img_url_large": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/e8b5b79d37ed/ico/stars/stars_large_3.png", "id": "all-star-cafe-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/902abeed0983/ico/stars/stars_small_3.png"}, {"is_claimed": false, "distance": 33.681434790762239, "mobile_url": "http://m.yelp.com/biz/allstar-donuts-and-sandwich-san-francisco", "rating_img_url": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/34bc8086841c/ico/stars/stars_3.png", "review_count": 15, "name": "Allstar Donuts \u0026 Sandwich", "snippet_image_url": "http://s3-media1.ak.yelpcdn.com/photo/3K7UIMosLELBFwxGeMwn3A/ms.jpg", "rating": 3.0, "url": "http://www.yelp.com/biz/allstar-donuts-and-sandwich-san-francisco", "location": {"city": "San Francisco", "display_address": ["1500 Market Street", "Hayes Valley", "San Francisco, CA 94102"], "geo_accuracy": 8, "neighborhoods": ["Hayes Valley", "Civic Center", "SoMa"], "postal_code": "94102", "country_code": "US", "address": ["1500 Market Street"], "coordinate": {"latitude": 37.775213999999998, "longitude": -122.4192852}, "state_code": "CA"}, "phone": "4152529888", "snippet_text": "This is a dirty little donut joint.  Which is hardly different than most donut joints.\n\nPros:\n- Delicious donuts (maple cake and maple cruller!  they have...", "image_url": "http://s3-media3.ak.yelpcdn.com/bphoto/mTIi4i5vo6gUP97KvWH0QQ/ms.jpg", "categories": [["Donuts", "donuts"], ["Coffee \u0026 Tea", "coffee"], ["Sandwiches", "sandwiches"]], "display_phone": "+1-415-252-9888", "rating_img_url_large": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/e8b5b79d37ed/ico/stars/stars_large_3.png", "id": "allstar-donuts-and-sandwich-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/902abeed0983/ico/stars/stars_small_3.png"}, {"is_claimed": false, "distance": 211.5927402483986, "mobile_url": "http://m.yelp.com/biz/grandmas-deli-and-cafe-san-francisco", "rating_img_url": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/stars_4.png", "review_count": 11, "name": "Grandma's Deli \u0026 Cafe", "snippet_image_url": "http://s3-media4.ak.yelpcdn.com/photo/SsKNUL-d8JcnxxX-slO5lg/ms.jpg", "rating": 4.0, "url": "http://www.yelp.com/biz/grandmas-deli-and-cafe-san-francisco", "location": {"cross_streets": "11th St \u0026 Lafayette St", "city": "San Francisco", "display_address": ["1551 Mission St", "(b/t 11th St \u0026 Lafayette St)", "SoMa", "San Francisco, CA 94103"], "geo_accuracy": 8, "neighborhoods": ["SoMa"], "postal_code": "94103", "country_code": "US", "address": ["1551 Mission St"], "coordinate": {"latitude": 37.773380500000002, "longitude": -122.41801580000001}, "state_code": "CA"}, "phone": "4152520759", "snippet_text": "I work next door to this place and I literally come here 5 days a week - and not only because it's next door because there's plenty of great food nearby....", "image_url": "http://s3-media4.ak.yelpcdn.com/bphoto/LpBSL-yC2HVR_IDo99OpNA/ms.jpg", "categories": [["Cafes", "cafes"], ["Coffee \u0026 Tea", "coffee"], ["Sandwiches", "sandwiches"]], "display_phone": "+1-415-252-0759", "rating_img_url_large": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/ccf2b76faa2c/ico/stars/stars_large_4.png", "id": "grandmas-deli-and-cafe-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/f62a5be2f902/ico/stars/stars_small_4.png"}, {"is_claimed": false, "distance": 420.33671199378347, "mobile_url": "http://m.yelp.com/biz/the-window-san-francisco-2", "rating_img_url": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/99493c12711e/ico/stars/stars_4_half.png", "review_count": 14, "name": "The Window", "snippet_image_url": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/07ecbaa39caf/gfx/blank_user_medium.gif", "rating": 4.5, "url": "http://www.yelp.com/biz/the-window-san-francisco-2", "snippet_text": "Great food and great concept - it is hard to get bored with a lunch place that changes every day. So far everything I tried was delicious.\n\nI don't believe...", "image_url": "http://s3-media3.ak.yelpcdn.com/bphoto/XaLLnmHJw1kg0Ce3KRRH_A/ms.jpg", "categories": [["Street Vendors", "streetvendors"], ["Sandwiches", "sandwiches"], ["Coffee \u0026 Tea", "coffee"]], "rating_img_url_small": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/a5221e66bc70/ico/stars/stars_small_4_half.png", "rating_img_url_large": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/9f83790ff7f6/ico/stars/stars_large_4_half.png", "id": "the-window-san-francisco-2", "is_closed": false, "location": {"cross_streets": "12th St \u0026 Lafayette St", "city": "San Francisco", "display_address": ["1599 Howard St", "(b/t 12th St \u0026 Lafayette St)", "SoMa", "San Francisco, CA 94103"], "geo_accuracy": 9, "neighborhoods": ["SoMa"], "postal_code": "94103", "country_code": "US", "address": ["1599 Howard St"], "coordinate": {"latitude": 37.771724700927699, "longitude": -122.416877746582}, "state_code": "CA"}}, {"is_claimed": true, "distance": 840.75273803298285, "mobile_url": "http://m.yelp.com/biz/philz-coffee-san-francisco-4", "rating_img_url": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/99493c12711e/ico/stars/stars_4_half.png", "review_count": 832, "name": "Philz Coffee", "snippet_image_url": "http://s3-media4.ak.yelpcdn.com/photo/xwD5DDjPNTvt0lYenxzgIg/ms.jpg", "rating": 4.5, "url": "http://www.yelp.com/biz/philz-coffee-san-francisco-4", "location": {"city": "San Francisco", "display_address": ["748 Van Ness Ave", "Fillmore", "San Francisco, CA 94102"], "geo_accuracy": 8, "neighborhoods": ["Fillmore", "Western Addition"], "postal_code": "94102", "country_code": "US", "address": ["748 Van Ness Ave"], "coordinate": {"latitude": 37.782428899999999, "longitude": -122.4206294}, "state_code": "CA"}, "phone": "4152927660", "snippet_text": "Dear Philz,\n\nYou are so good to me. Too good, in fact. Each sip of your rich coffee is pure bliss. Each sip of your extremely strong and not bitter at all...", "image_url": "http://s3-media2.ak.yelpcdn.com/bphoto/B90TD4l3w-Aa_KV1F4RJuQ/ms.jpg", "categories": [["Coffee \u0026 Tea", "coffee"]], "display_phone": "+1-415-292-7660", "rating_img_url_large": "http://s3-media2.ak.yelpcdn.com/assets/2/www/img/9f83790ff7f6/ico/stars/stars_large_4_half.png", "id": "philz-coffee-san-francisco-4", "is_closed": false, "rating_img_url_small": "http://s3-media4.ak.yelpcdn.com/assets/2/www/img/a5221e66bc70/ico/stars/stars_small_4_half.png"}, {"is_claimed": false, "distance": 419.90929506449498, "mobile_url": "http://m.yelp.com/biz/allstar-cafe-san-francisco", "rating_img_url": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/5ef3eb3cb162/ico/stars/stars_3_half.png", "review_count": 22, "name": "Allstar Cafe", "snippet_image_url": "http://s3-media2.ak.yelpcdn.com/photo/Tx8oXPMPyGdIqq20HRbKxA/ms.jpg", "rating": 3.5, "url": "http://www.yelp.com/biz/allstar-cafe-san-francisco", "location": {"cross_streets": "Jessie St \u0026 Mission St", "city": "San Francisco", "display_address": ["98 9th Street", "(b/t Jessie St \u0026 Mission St)", "SoMa", "San Francisco, CA 94103"], "geo_accuracy": 8, "neighborhoods": ["SoMa"], "postal_code": "94103", "country_code": "US", "address": ["98 9th Street"], "coordinate": {"latitude": 37.776249800000002, "longitude": -122.4149391}, "state_code": "CA"}, "phone": "4158634949", "snippet_text": "Allstar cafe had the biggest donuts i've ever seen. it's a cafe since they also sell breakfast and bagel sammies.\n\neats: glazed donut (.95)\n-donut almost as...", "image_url": "http://s3-media1.ak.yelpcdn.com/bphoto/os0xUtFX6EaQL7RsxteQSQ/ms.jpg", "categories": [["Donuts", "donuts"], ["Coffee \u0026 Tea", "coffee"], ["Bakeries", "bakeries"]], "display_phone": "+1-415-863-4949", "rating_img_url_large": "http://s3-media1.ak.yelpcdn.com/assets/2/www/img/bd9b7a815d1b/ico/stars/stars_large_3_half.png", "id": "allstar-cafe-san-francisco", "is_closed": false, "rating_img_url_small": "http://s3-media3.ak.yelpcdn.com/assets/2/www/img/2e909d5d3536/ico/stars/stars_small_3_half.png"}]}
    # eos
    # return yelp_query

  end

  def self.path(location)
    "#{api_search_path}?term=coffee&ll=#{location}"
  end

  def self.region(location)
    JSON.parse(query(location))["region"] || []
  end

  def self.businesses(location)
    JSON.parse(query(location))["businesses"] || []
  end
end